!function(){"use strict";var t={title:"Из предложенных фрагментов составьте известные пословицы?",background:"./img/fon.png",itemStyle:{width:"600px"},groups:[{id:"grp-1",isShuffled:!1,elementHeight:"small-height",items:[{id:1,title:"Кто за правду горой,"},{id:2,title:"Героям страх"},{id:3,title:"Тот герой, кто"},{id:4,title:"Герой за славой"},{id:5,title:"Подвиг делает тот,"},{id:6,title:"За каждого героя"}]},{id:"grp-2",isShuffled:!0,elementHeight:"small-height",items:[{id:1,parentId:1,title:"тот настоящий герой"},{id:2,parentId:2,title:"неведом"},{id:3,parentId:3,title:"за Родиной горой"},{id:4,parentId:4,title:"не гонится"},{id:5,parentId:5,title:"кто вперед идет"},{id:6,parentId:6,title:"Родина горою"}]}]},e={title:"Собери пословицы о героях",background:"./img/fon2.png",itemStyle:{width:"600px"},groups:[{id:"grp-1",isShuffled:!1,elementHeight:"normal-height",items:[{id:1,title:"Кто за правду горой,"},{id:2,title:"Героям страх"},{id:3,title:"Тот герой, кто"},{id:4,title:"Герой за славой"},{id:5,title:"Подвиг делает тот,"},{id:6,title:"За каждого героя"}]},{id:"grp-2",isShuffled:!0,elementHeight:"normal-height",items:[{id:1,parentId:1,title:"тот настоящий герой"},{id:2,parentId:2,title:"неведом"},{id:3,parentId:3,title:"за Родину горой"},{id:4,parentId:4,title:"не гонится"},{id:5,parentId:5,title:"кто вперед идет"},{id:6,parentId:6,title:"Родина горою"}]}]};class i{template;parent;activeElement;constructor(t){this.parent=t}init(t){const e=document.createElement("div");e.classList.add("page-container"),e.innerHTML=this.template,this.activeElement=e,this.parent.appendChild(e),setTimeout((()=>{this.onInit(t)}))}destroy(){this.activeElement.remove(),this.onDestroy()}onInit(){throw new Error('Not implemented method "onInit"!')}onDestroy(){}}class s extends i{app;template='\n<div id="player_container" class="player__container">\n    <h1 id="player_title">Title</h1>\n    <div id="player_content"></div>\n    <button id="player_check_button">Проверить</button>\n</div>\n';playerCheckButton;container;content;test;groupElements=[];activeItems=[];activeGroupIx=0;activeItem=null;firstActiveElement=null;constructor(t,e){super(t),this.app=e}onInit(t){this.test=this.shuffleTestItems(t),setTimeout((()=>{this.setElements(),this.renderTest(),this.handleButtonClick()}))}shuffleTestItems(t){return t.groups.forEach((t=>{t.isShuffled&&(t.items=t.items.sort((()=>Math.random()-.5)))})),t}setElements(){this.container=document.querySelector("#player_container"),this.title=document.querySelector("#player_title"),this.content=document.querySelector("#player_content"),this.playerCheckButton=document.querySelector("#player_check_button"),this.playerCheckButton.disabled=!1}renderTest(){this.groupElements=[],this.title.innerText=this.test.title,this.container.style.backgroundImage=`url(${this.test.background})`;let t=0;this.test.groups.forEach((e=>{const i=document.createElement("div");i.classList.add("player_group"),i.id=e.id,this.groupElements.push(i),i.innerHTML=`\n        ${e.title?`<h2>${e.title}</h2>`:""}\n        ${e.items.map((i=>`<div class="player_group-item ${e.elementHeight}" data-group-id="${e.id}" data-group-ix="${t}" id="${i.id}">${i.title}</div>`)).join("")}\n      `,this.content.appendChild(i),this.setGroupItems(i),1==i.querySelectorAll(".player_group-item").length&&0==t&&(this.firstActiveElement=i.querySelectorAll(".player_group-item")[0]),t+=1})),document.querySelectorAll(".player_group-item").forEach((t=>{let e=.8*parseInt(t.style.width);t.style.width=e+"px"}))}setGroupItems(t){t.groupItemElements=t.querySelectorAll(".player_group-item"),t.groupItemElements.forEach((t=>{t.linked=null,t.focused=!1,t.active=!1,this.setItemStyle(t),this.handleItemClick(t),this.handleItemHover(t)}))}setItemStyle(t){this.test.itemStyle&&this.test.itemStyle.width&&(t.style.width=this.test.itemStyle.width)}handleItemHover(t){t.addEventListener("mouseover",(()=>{if(t.active)return;this.activeGroupIx===Number(t.dataset.groupIx)&&t.classList.add("outline");const e=Number(t.dataset.groupIx);!t.parentLink&&this.activeItem&&this.activeGroupIx===e&&(this.activeItem.hoverLink=new LeaderLine(this.activeItem,t,{color:"#5b66ce",size:2}))})),t.addEventListener("mouseleave",(()=>{t.classList.remove("outline"),this.activeItem&&this.activeItem.hoverLink&&(this.activeItem.hoverLink.remove(),this.activeItem.hoverLink=null)}))}handleItemClick(t){t.addEventListener("click",(()=>{if(t.hasOwnProperty("isCorrect")&&null!==t.isCorrect)return t.link.remove(),t.isCorrect=null,void t.classList.remove("active");const e=Number(t.dataset.groupIx);if(this.activeGroupIx!==e)return t.active?void(e===this.test.groups.length-1&&null===this.activeItem||t.parentLink&&!t.linked?this.deactivateItem(t):t.parentLink||this.deactivateItem(t)):void 0;if(this.activateItem(t),this.activeGroupIx>0){this.activeItem.linked=t,t.parentLink=this.activeItem,this.activeItem.classList.add("linked");let e=new LeaderLine(this.activeItem,t,{color:"#5b66ce",size:2});this.activeItem.link=e,t.link=e,this.checkRightAnswer(t,this.activeItem.id)?t.isCorrect=!0:t.isCorrect=!1,this.checkAllAnswered()}this.activeGroupIx===this.test.groups.length-1?(this.activeGroupIx=0,this.activeItems=[],this.activeItem=null,null!==this.firstActiveElement&&(console.log(this.firstActiveElement),this.firstActiveElement.click())):(this.activeGroupIx+=1,this.activeItem=t)}))}activateItem(t){this.activeItems.push(t.id),t.classList.add("active")}deactivateItem(t){this.activeItems=this.activeItems.filter((e=>e!==t.id)),t.active=!1,t.classList.remove("active"),t.parentLink?(this.activeGroupIx=Number(t.parentLink.dataset.groupIx)+1,this.activeItem=t.parentLink,this.removeItemParentLink(t)):(this.activeGroupIx=0,this.activeItem=null)}removeItemParentLink(t){t.parentLink.linked=!1,t.parentLink.link.remove(),t.parentLink.classList.remove("linked"),t.parentLink=null}handleButtonClick(){this.playerCheckButton.addEventListener("click",(()=>{this.checkAnswers()}))}checkAllAnswered(){const t=this.groupElements[this.groupElements.length-1];let e;t&&(e=t.groupItemElements),[].filter.call(e,(t=>t.parentLink))}checkAnswers(){this.groupElements.forEach((t=>{[].forEach.call(t.groupItemElements,(t=>{t.hasOwnProperty("isCorrect")&&null!==t.isCorrect&&(t.isCorrect?(t.classList.add("right"),t.link.color="#07d67b"):(t.classList.add("wrong"),t.link.color="#ff5252"))}))}))}getGroupItemTestElement(t,e){return this.test.groups[e].items.find((e=>e.id===Number(t.id)))}checkRightAnswer(t,e){return this.test.groups[this.activeGroupIx].items.find((e=>e.id===Number(t.id))).parentId==e}getLinkedItems(t){const e=[t];let i=t.linked;for(;i.linked;)e.push(i),i=i.linked;return e.push(i),e}}class n{player;certResult;states=[];activeComponent;tests=[t,e];constructor(){}init(){new URLSearchParams(window.location.search);const t=document.querySelector(".home");this.player=new s(t,this),this.states.push({name:"player",component:this.player});this.changeState("player",this.tests[1])}changeState(t,e){const i=this.states.find((e=>e.name===t));if(this.activeComponent&&this.activeComponent.destroy(),!i)throw new Error(`State: ${t} not found!`);this.activeComponent=i.component,this.activeComponent.init(e)}}window.onload=function(){(new n).init()}}();
